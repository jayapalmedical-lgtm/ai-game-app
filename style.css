// ---------------- Section Switch ----------------
function showSection(id) {
    document.querySelectorAll('.game-section').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

// ---------------- Tic-Tac-Toe ----------------
let tttBoard = ["", "", "", "", "", "", "", "", ""];
let tttPlayer = "X";

function drawTicTacToe() {
    const boardDiv = document.getElementById('ttt-board');
    boardDiv.innerHTML = '';
    tttBoard.forEach((cell, index) => {
        const div = document.createElement('div');
        div.classList.add('cell');
        div.textContent = cell;
        div.onclick = () => makeMove(index);
        boardDiv.appendChild(div);
    });
}

function makeMove(index) {
    if (tttBoard[index] === "") {
        tttBoard[index] = tttPlayer;
        tttPlayer = tttPlayer === "X" ? "O" : "X";
        aiMove();
        drawTicTacToe();
        checkWinner();
    }
}

function aiMove() {
    let empty = tttBoard.map((v,i)=> v==""?i:null).filter(v=>v!=null);
    if(empty.length===0) return;
    let move = empty[Math.floor(Math.random()*empty.length)];
    tttBoard[move] = "O";
    tttPlayer = "X";
}

function checkWinner() {
    const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
    ];
    for(let w of wins){
        const [a,b,c] = w;
        if(tttBoard[a] && tttBoard[a]===tttBoard[b] && tttBoard[a]===tttBoard[c]){
            alert(tttBoard[a] + " wins!");
            resetTicTacToe();
        }
    }
}

function resetTicTacToe(){
    tttBoard = ["", "", "", "", "", "", "", "", ""];
    drawTicTacToe();
}

drawTicTacToe();

// ---------------- Quiz ----------------
const questions = [
    {q:"What is 7 x 8?", a:"56"},
    {q:"Capital of India?", a:"New Delhi"},
    {q:"H2O is chemical formula of?", a:"Water"},
    {q:"Square of 12?", a:"144"},
    {q:"7+6-3=?", a:"10"}
];

let currentQ = 0;

function checkQuizAnswer(){
    let ans = document.getElementById('quiz-answer').value;
    let feedback = document.getElementById('quiz-feedback');
    if(ans.trim().toLowerCase() === questions[currentQ].a.toLowerCase()){
        feedback.textContent = "Correct!";
    } else {
        feedback.textContent = "Wrong! Answer: " + questions[currentQ].a;
    }
    currentQ = (currentQ+1)%questions.length;
    document.getElementById('quiz-question').textContent = questions[currentQ].q;
    document.getElementById('quiz-answer').value = "";
}

// Initialize first question
document.getElementById('quiz-question').textContent = questions[currentQ].q;

// ---------------- Find My Number ----------------
let numberToGuess = Math.floor(Math.random()*100)+1;

function checkGuess(){
    let guess = Number(document.getElementById('guess').value);
    let feedback = document.getElementById('guess-feedback');
    if(guess === numberToGuess) {
        feedback.textContent = "ðŸŽ‰ Correct! Number was " + numberToGuess;
        numberToGuess = Math.floor(Math.random()*100)+1;
    } else if(guess < numberToGuess) {
        feedback.textContent = "Too low!";
    } else {
        feedback.textContent = "Too high!";
    }
}

// ---------------- Chess AI ----------------
const initialChessBoard = [
  ["r","n","b","q","k","b","n","r"],
  ["p","p","p","p","p","p","p","p"],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["P","P","P","P","P","P","P","P"],
  ["R","N","B","Q","K","B","N","R"]
];

let chessBoard = [];
let selectedPiece = null;

function resetChess(){
    chessBoard = initialChessBoard.map(row => [...row]);
    selectedPiece = null;
    drawChess();
}

function drawChess(){
    const boardDiv = document.getElementById('chess-board');
    boardDiv.innerHTML = '';
    for(let i=0;i<8;i++){
        for(let j=0;j<8;j++){
            const cell = document.createElement('div');
            cell.classList.add('chess-cell');
            cell.classList.add((i+j)%2===0?'chess-white':'chess-black');
            cell.textContent = chessBoard[i][j];
            cell.dataset.row = i;
            cell.dataset.col = j;
            cell.onclick = () => clickChessCell(i,j);
            boardDiv.appendChild(cell);
        }
    }
}

function clickChessCell(row,col){
    if(selectedPiece){
        const [r0,c0] = selectedPiece;
        if(r0 === row && c0 === col){ selectedPiece=null; return; }
        const piece = chessBoard[r0][c0];
        const target = chessBoard[row][col];
        if((piece===piece.toUpperCase() && !target.toUpperCase()) ||
           (piece===piece.toLowerCase() && !target.toLowerCase()) ||
           !target){
            chessBoard[row][col] = piece;
            chessBoard[r0][c0] = "";
            selectedPiece = null;
            drawChess();
            setTimeout(chessAIMove,200);
        }
    } else if(chessBoard[row][col]!=="") {
        selectedPiece=[row,col];
    }
}

// very simple AI: moves random piece one step
function chessAIMove(){
    let moves = [];
    for(let i=0;i<8;i++){
        for(let j=0;j<8;j++){
            let p = chessBoard[i][j];
            if(p && p===p.toLowerCase()){ // AI plays lowercase pieces
                let dirs = [[1,0],[-1,0],[0,1],[0,-1]]; // up/down/left/right simple
                for(let [dr,dc] of dirs){
                    let r=i+dr, c=j+dc;
                    if(r>=0 && r<8 && c>=0 && c<8){
                        let target = chessBoard[r][c];
                        if(!target || target===target.toUpperCase()){
                            moves.push({from:[i,j],to:[r,c]});
                        }
                    }
                }
            }
        }
    }
    if(moves.length>0){
        let move = moves[Math.floor(Math.random()*moves.length)];
        const [fr,fc]=move.from;
        const [tr,tc]=move.to;
        chessBoard[tr][tc]=chessBoard[fr][fc];
        chessBoard[fr][fc]="";
        drawChess();
    }
}

resetChess();
